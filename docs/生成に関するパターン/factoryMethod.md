# Factory Methodパターン

本のソースに誤りがあり、趣旨がよくわからないので、エッセンスだけを抜き出し


別事例

- [PHPによるデザインパターン入門 \- Factory Method〜生成処理と使用処理を分離する \- Do You PHP はてブロ](http://shimooka.hateblo.jp/entry/20141215/1418620242)


## メリット


### オブジェクトの生成過程の隠蔽と集中管理


オブジェクト生成の方法に注目したパターン


単純な生成クラスではなくテンプレートメソッド的なオブジェクト準備の過程をabsractメソッドに定義して、**オブジェクト生成と準備を抽象化**

多様なインスタンス生成を請け負うオブジェクト生成は強い依存を生むので、切り離すだけでも大きなメリットがある

つまり、**インスタンス生成時に決まった手順でhogehogeする**を抽象クラスから強制できる


復習:
templatemethodでは、処理の流れを実際の処理から抽象化した
それぞれdoActionという名前で、
validateしてエラーがあればエラーを投げて、
なければdoMainするという流れを踏んだ


## シナリオ CSVかXMLかの方

今回の実装。上記リンクから趣旨を抜き出す

- ある既存のCSV出力メソッドを,XMLにも対応させたいとする
- ifでCSVかXMLか分岐させればできそう
- しかしさらにファイル形式の対応を増やしていけば、if文が増えるばかり

ユーザがやりたいことはファイル形式が何であれ

1. 読み込む read
2. 表示する display

これだけ。

具体的な読み込み方法や表示方法はそれぞれのファイル形式に対応させたファクトリに任せる


## シナリオ システム開発

ベンダー企業とクライアントがいる

とあるクライアントはデータセンターを運営しようとして、データセンターシステムを外注しようとする。
とあるクライアントはPOSシステムを外注しようとする。

クライアントはベンダーの営業(ConcreteFactory)に
**発注して納品待ち** をする。だけ。どんな開発体制が取られるかは(監査を入れるでもしようとしなければ)ベンダー側に任せる

ベンダーは受注内容から
データセンターシステムの受注ならその道のスペシャリストに、
POSシステムならその道のスペシャリストに開発をさせる。

ベンダーのエンジニアは共通して「開発」と「納品」ができるが、それぞれ手法は専門領域や開発スタイルから完全に異なる


## シナリオ 料理

釣りが趣味のおっさんと持込OKレストラン

おっさんは釣った魚をレストランに渡して、調理済みの魚料理をもらう
レストランは魚の種類によって、一番美味しく食べられる調理方法が可能な料理人に魚を調理させる


登場人物

- おっさん: クライアント
- レストラン：ファクトリ
- 料理人：プロダクトの作り手。ファクトリに生成される
- 料理：プロダクト


## クラス図

![](https://upload.wikimedia.org/wikipedia/commons/8/8e/Factory_Method_UML_class_diagram.svg)



## マンガでわかる Factory Method


## ソース

### PHP

[include](../../patterns/FactoryMethod/index.php)

