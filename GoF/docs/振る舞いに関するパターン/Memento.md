# Memento

> **状態を保存する**

## 概要

やり直しのスナップショットをとって置く

インスタンスを復元したいとき、アクセス修飾子をprivate以外にしないといけなくなる(しなくてもいいけど、内部構造に依存したプログラムになる。**カプセル化の破壊**)




### ミソ

スナップショットは実態よりはるかに軽いもの
なのでケアテイカーはバックアップをいくらでもスタックしておける
オブジェクトそのものでなくその属性のコピーなどでも良し


## 登場人物

- オリジネイター：リアルな事象。メメントを提供したり自分をメメントで更新したり
- ケアテイカー：適切なタイミングでオリジネイターのバックアップを残す
  - まずオリジネイターに「バックアップを取る」ことを通知
  - オリジネイターはメメントを作成する
  - ケアテイカーはそのメメントを受け取り、保存する
  - **狭いインタフェース**しか使えない。メメントはひとかたまりのブラックボックスとして置いておく
- メメント：バックアップ。オリジネイターの内部情報を持つ
  - 狭いインタフェース: ケアテイカーが利用できるインタフェース
    - ここでの狭いとは「内部状態を操作できる度合いが少ない」publicなインタフェース
  - 広いインタフェース: メメントはケアテイカーやMainが作るのではなく、オリジネイター(同一パッケージ)しか作れない
    - 広いとは、内部状態をいじれるpackage privateなインタフェース



## クラス図

![memento\.gif \(442×157\)](https://www.dofactory.com/images/diagrams/net/memento.gif)


## ユースケース

### Git

「スナップショット」がそのままメメントだし、オリジネイターはソースコード本体。本体のバックアップではなく圧縮ファイルを取っておいて、好きなところまで巻き戻しを行える。

## ソース

### PHP

[include](../../patterns/Memento/index.php)
